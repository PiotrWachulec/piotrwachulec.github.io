<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=Content-Language content="en"><meta name=author content="Piotr Wachulec"><meta name=description content="Feature toggles is an mechanism which allows you to control features in your application. For instance if you want to disable some functionality you can to that by changing some part of configuration. In this post I will show you how to configure it."><meta name=keywords content="blog,developer,architect,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Feature toggles in .NET Core and Azure"><meta name=twitter:description content="Feature toggles is an mechanism which allows you to control features in your application. For instance if you want to disable some functionality you can to that by changing some part of configuration. In this post I will show you how to configure it."><meta property="og:url" content="https://wachulec.me/posts/feature-toggles-in-dotnet-core-and-azure/"><meta property="og:site_name" content="Piotr Wachulec"><meta property="og:title" content="Feature toggles in .NET Core and Azure"><meta property="og:description" content="Feature toggles is an mechanism which allows you to control features in your application. For instance if you want to disable some functionality you can to that by changing some part of configuration. In this post I will show you how to configure it."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-18T10:42:02+02:00"><meta property="article:modified_time" content="2020-05-18T10:42:02+02:00"><meta property="article:tag" content=".Net"><meta property="article:tag" content=".Net Core"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Cicd"><title>Feature toggles in .NET Core and Azure · Piotr Wachulec
</title><link rel=canonical href=https://wachulec.me/posts/feature-toggles-in-dotnet-core-and-azure/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://wachulec.me/css/coder.min.f01c647a0d25b40da992a37c3376291185eed8a50ced8c26cc2c0bcfe38c97df.css integrity="sha256-8Bxkeg0ltA2pkqN8M3YpEYXu2KUM7YwmzCwLz+OMl98=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://wachulec.me/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://wachulec.me/css/mailchimp_form.css><link rel=icon type=image/png href=https://wachulec.me/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://wachulec.me/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://wachulec.me/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://wachulec.me/images/apple-touch-icon.png><meta name=generator content="Hugo 0.125.5"></head><body class=colorscheme-dark><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://wachulec.me/>Piotr Wachulec
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://wachulec.me/offer/>Offer</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/speeches/>Speeches</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/contact/>Contact</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/socials/>Socials</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/press-kit/>Press kit</a></li><li class=navigation-item><a class=navigation-link href=https://wachulec.me/privacy/>Privacy</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Feature toggles in .NET Core and Azure</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-05-18T10:42:02+02:00>May 18, 2020
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
7-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=https://wachulec.me/categories/c#-.net/>C# .NET</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<a href=https://wachulec.me/tags/.net/>.net</a>
<span class=separator>•</span>
<a href=https://wachulec.me/tags/.net-core/>.net core</a>
<span class=separator>•</span>
<a href=https://wachulec.me/tags/azure/>azure</a>
<span class=separator>•</span>
<a href=https://wachulec.me/tags/cicd/>cicd</a></div></div></header><div><h1 id=intro>Intro</h1><p>Feature toggles is an mechanism which allows you to control features and manage them within your application. For instance if you want to disable some functionality you can to that by changing some part of configuration without redeployment, rebuild etc. In this post I will show you how to configure it in a few easy steps in .NET Core web application and Azure. At the end you will find repository with example code which you can test it on your own.</p><h1 id=prerequisites>Prerequisites</h1><p>For using <em>FeatureManagement</em> in .NET Core application you will need two NuGet packages which you can install with two below commands with <strong>dotnet cli</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package Microsoft.Azure.AppConfiguration.AspNetCore
</span></span><span style=display:flex><span>dotnet add package Microsoft.FeatureManagement.AspNetCore
</span></span></code></pre></div><p>The first package called <strong>Microsoft.Azure.AppConfiguration.AspNetCore</strong> will be necessary if you want to use Azure App Configuration. If you want to store all feature toggles (aka feature flags) f.g. in <em>appsettings.json</em>, you don&rsquo;t have to install the first package and you should install only the second one called <strong>Microsoft.FeatureManagement.AspNetCore</strong>. And of course you have to have some .NET Core app where you will implement feature toggles mechanism &#x1f609;.</p><p>If you would like to manage the feature toggles from Azure, you have to create <a href=https://docs.microsoft.com/en-us/azure/azure-app-configuration/overview>Azure App Configuration</a> - it is special service which allows you to manage app settings and feature flags from one place. You can create instance of Azure App Configuration like the other services in Azure - try to find App Configuration in the Marketplace. Before you create App Configuration, check the <a href=https://azure.microsoft.com/en-us/pricing/details/app-configuration/>pricing details</a>. For test and learn purposes you will definitely need the free version, but maybe you will need standard licence in production app.</p><h1 id=app-configuration>App configuration</h1><p>If you installed the packages from the previous paragraph, you are ready to start your adventure with feature flags. I will focus only on WebAPI app, because this kind of apps I&rsquo;m developing on my daily basis. If you want to expand your knowledge, I would like to invite you to the last section of article called <strong>Literature</strong> where you can find many useful sources.</p><h2 id=basic>Basic</h2><p>For using <em>FeatureManagement</em> in your app you have to do two things:</p><ul><li>in <strong>ConfigureServices</strong> method in <strong>Startup</strong> class you have to add <em>FeatureManagement</em>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>services.AddFeatureManagement();
</span></span></code></pre></div><ul><li>in <em>appsettings.json</em> you have to add section called <em>FeatureManagement</em></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Logging&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;LogLevel&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Default&#34;</span>: <span style=color:#e6db74>&#34;Information&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Microsoft&#34;</span>: <span style=color:#e6db74>&#34;Warning&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Microsoft.Hosting.Lifetime&#34;</span>: <span style=color:#e6db74>&#34;Information&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;AllowedHosts&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;FeatureManagement&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;FeatureA&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;FeatureB&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Of course you can set any names of feature flags, it&rsquo;s only example. You can change name of section too by parameterization of <strong>AddFeatureManagement</strong> method.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>services.AddFeatureManagement(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.UseConfiguration(Configuration.GetSection(<span style=color:#e6db74>&#34;MyFeatureFlags&#34;</span>));
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=with-azure-app-configuration>With Azure App Configuration</h2><p>If you would like to use Azure App Configuration too, you have to prepare <strong>CreateHostBuilder</strong> method from <strong>Program</strong> class like below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> IHostBuilder CreateHostBuilder(<span style=color:#66d9ef>string</span>[] args) =&gt;
</span></span><span style=display:flex><span>    Host.CreateDefaultBuilder(args)
</span></span><span style=display:flex><span>        .ConfigureWebHostDefaults(webBuilder =&gt;
</span></span><span style=display:flex><span>            webBuilder.ConfigureAppConfiguration((hostingContext, config) =&gt;
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>var</span> settings = config.Build();
</span></span><span style=display:flex><span>                    config.AddAzureAppConfiguration(options =&gt;
</span></span><span style=display:flex><span>                    {
</span></span><span style=display:flex><span>                        options.Connect(settings[<span style=color:#e6db74>&#34;ConnectionStrings:AppConfig&#34;</span>])
</span></span><span style=display:flex><span>                            .UseFeatureFlags();
</span></span><span style=display:flex><span>                    });
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>                .UseStartup&lt;Startup&gt;());
</span></span></code></pre></div><p>and add middleware in <strong>Configure</strong> method in <strong>Startup</strong> class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>app.UseAzureAppConfiguration();
</span></span></code></pre></div><p>As you can see above, there is necessary to set connection string to the App Configuration in app. I stored it in <em>appsettings.json</em>, but you have to remember not to commit it to the repository &#x1f609;. You can to store it in environment variable and so on.</p><p>Then you have to add some feature toggles in App Configuration. Go to your App Configuration section. In <strong>Operations</strong> part in menu on the left side you can find button called <strong>Feature manager</strong>.</p><p><img src=https://wachulec.me/images/posts/2020-05-18-feature-toggles-in-dotnet-core-and-azure/feature_manager_button.png alt="Feature manager button"></p><p>After clicking on this button you can find list of currently created flags with current states. You can switch state of flag in this place.</p><p><img src=https://wachulec.me/images/posts/2020-05-18-feature-toggles-in-dotnet-core-and-azure/list_of_feature_flags.png alt="List of feature toggles"></p><p>You can create new flag by clicking on button <strong>Add</strong> above the list.</p><p><img src=https://wachulec.me/images/posts/2020-05-18-feature-toggles-in-dotnet-core-and-azure/add_new_feature_flag.png alt="Add new feature toggle"></p><h1 id=usage>Usage</h1><p>It is worth noting that you can store feature toggles configuration in both places for one application, so you can hold part of feature toggles configuration in <em>appsettings.json</em> file and the rest in App Configuration and use them in the same time. In <strong>Literature</strong> section you can find great and complex article about types of feature toggles and ways of managing them written by Pete Hodgson on Martin Fowler&rsquo;s blog, so I can imagine that you would like to split your toggles configuration.</p><h2 id=enumeration>Enumeration</h2><p>For easy access to feature toggles and avoiding typos, you can create enumeration of feature flags in code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>namespace</span> FeatureTogglesInNETCore
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>enum</span> MyFeatureFlags
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        FeatureA,
</span></span><span style=display:flex><span>        FeatureB,
</span></span><span style=display:flex><span>        FeatureC
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=by-example>By example</h2><p>Below you can find an example controller prepared for the explanation purposes.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Threading.Tasks;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.FeatureManagement;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.FeatureManagement.Mvc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> FeatureTogglesInNETCore.Controllers
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [Route(&#34;[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HomeController</span> : Controller
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IFeatureManager _featureManager;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> HomeController(IFeatureManager featureManager)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            _featureManager = featureManager;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>        [HttpGet(&#34;FeatureA&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [FeatureGate(MyFeatureFlags.FeatureA)]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> IActionResult GetA()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Feature A works!&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>        [HttpGet(&#34;FeatureB&#34;)]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; GetB()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>await</span> _featureManager.IsEnabledAsync(nameof(MyFeatureFlags.FeatureA)))
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Feature B is enabled&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Feature B is NOT enabled&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>        [HttpGet(&#34;FeatureC&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [FeatureGate(MyFeatureFlags.FeatureC)]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> IActionResult GetC()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Feature C works&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Between lines 12th and 17th you can find injection of service which implement <strong>IFeatureManager</strong> interface. It is service which allows you to get state of feature toogle. How? An example you can see in lines 29 - 32th. Of course we can hide this strange <em>if</em> instruction in factory, strategy, decorator or whatever you what - this is not purpose of this article and it depends on context.</p><p>Changing state in <em>appsettings</em> file or in App Configuration in Azure will impact on the app behavior. When you will set <em>FeatureA</em> or <em>FeatureC</em> flags on <em>false</em>, then you will get HTTP404 error. I hope you noticed <strong>FeatureGate</strong> annotations in lines 20th and 38th. It allows to switch off controller method. You can add this annotation to controller&rsquo;s class too, so when you will change state of toogle, you will switch on or switch off whole controller. When you change the state of <em>FeatureB</em> toggle, you will get an appropriate inscription depending on the state.</p><h2 id=switching-toggles>Switching toggles</h2><p>You have to remember that thanks to use this mechanism, you don&rsquo;t have to recompile code and rebuild the package or comment code, create many feature branches etc. You have full configuration in one place and you can simply switch on and off parts of application. If you change configuration in <em>appsettings</em> file, you have to restart application. When you will change toggle in App Configuration, toggles will reload automatically without restarting application - by default after 30 seconds. Of course here you have possibility of changing configuration configuration.</p><h1 id=to-sum-up>To sum up</h1><p>I hope you saw that it&rsquo;s really easy mechanism in implementation, but of course in usage it can be as easy as it is very difficult. Many depends on context, number of toggles, architecture of application and so on. In this article I wanted to show you technical part of implementation with Azure and .NET Core. I prepared example project which you can clone and test on your own. You can find it on my <a href=https://github.com/PiotrWachulec/FeatureTogglesInNETCore>GitHub</a>. Remember that if you want to test it with App Configuration, you have to set connection string to App Configuration in <em>appsettings.json</em> file.</p><h1 id=literature>Literature</h1><p>Below you can find sources which can be helpful in exploration of feature toggles topic and on which the article is based on:</p><ul><li><a href=https://martinfowler.com/bliki/FeatureToggle.html>Martin Fowler: &ldquo;Feature Toggles&rdquo;</a></li><li><a href=https://martinfowler.com/articles/feature-toggles.html>Pete Hodgson on Martin Fowler&rsquo;s blog: &ldquo;Feature Toggles (aka Feature Flags)</a></li><li><a href=https://devblogs.microsoft.com/aspnet/redesigning-configuration-refresh-for-azure-app-configuration/>Microsoft ASP.NET Blog: Redesigning Configuration Refresh for Azure App Configuration</a></li><li><a href=https://kasunkodagoda.com/2020/01/16/implementing-feature-flags-for-asp-net-core-applications-using-microsoft-featuremanagement-library/>Kasun Kodagoda: &ldquo;Feature Flags for ASP.Net Core Applications using Microsoft.FeatureManagement Library&rdquo;</a></li><li><a href=https://dev.to/integerman/safe-net-feature-flags-with-featuretoggle-450h>Matt Eland on Dev.to: &ldquo;Safe .NET Feature Flags with FeatureToggle&rdquo;</a></li><li><a href=https://victorops.com/blog/when-and-why-to-adopt-feature-flags>Chris Tozzi: When and Why to Adopt Feature Flags</a></li><li>Microsoft docs:<ul><li><a href=https://docs.microsoft.com/en-us/azure/azure-app-configuration/quickstart-dotnet-core-app>Quickstart: Create a .NET Core app with App Configuration</a></li><li><a href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/quickstart-feature-flag-aspnet-core?tabs=core3x">Quickstart: Add feature flags to an ASP.NET Core app</a></li><li><a href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/use-feature-flags-dotnet-core?source=docs#mvc-filters">Tutorial: Use feature flags in an ASP.NET Core app</a></li><li><a href=https://docs.microsoft.com/en-us/azure/azure-app-configuration/enable-dynamic-configuration-dotnet-core>Tutorial: Use dynamic configuration in a .NET Core app</a></li></ul></li></ul><h3>Newsletter</h3><p>Thank you for visiting my website. I hope you enjoyed the content that I prepared and learned something valuable from it. If you want to be informed about my next entries or occasionally get a message with a collection of some interesting links, please subscribe to my newsletter. I will be extremely pleased if you do this and join my community!</p><form action="https://wachulec.us4.list-manage.com/subscribe/post?u=2324c62a24ba49bf4fe638e7a&amp;id=d8fba7ef5c" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form target=_blank validate><ul class=form-style-1><li><label for=mce-FNAME>Name <span class=required>*</span></label>
<input type=text name=FNAME class=field-long></li><li><label for=mce-EMAIL>Email <span class=required>*</span></label>
<input type=email name=EMAIL class=field-long></li><li style=display:none><input type=checkbox value=2 name=group[70044][2] id=mce-group[70044]-70044-0 checked>
<label for=mce-group[70044]-70044-0>BlogPost</label></li><li><fieldset class="mc_fieldset gdprRequired mc-field-group" name=interestgroup_field style=display:none><label class="checkbox subfield" for=gdpr_43552><input type=checkbox id=gdpr_43552 name=gdpr[43552] value=Y class=av-checkbox checked><span>Send me emails!</span></label></fieldset><p><small>By clicking button below you agree to send you news from my blog, about my products and services. Above data are stored in Mailchimp and I do not share them to anyone. More info you can find in <a href=//wachulec.me/privacy/>privacy policy.</a></small></p></li><li><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe></li><li><div id=mce-responses class=clear><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_2324c62a24ba49bf4fe638e7a_d8fba7ef5c tabindex=-1></div></li></ul></form><script type=text/javascript src=//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js></script><script type=text/javascript>(function(){window.fnames=new Array,window.ftypes=new Array,fnames[0]="EMAIL",ftypes[0]="email",fnames[1]="FNAME",ftypes[1]="text"})(jQuery);var $mcj=jQuery.noConflict(!0)</script></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wachulec-me.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></section></div><footer class=footer><section class=container><p>There are no problems, there are only challenges.</p>©
2020 -
2024
Piotr Wachulec
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=https://wachulec.me/js/dark-mode.min.c2d8a1f8f2660e4a46d776277c72695a1e0ca65939d79f754441d47551604af5.js></script><script src="https://cdn.jsdelivr.net/npm/cookie-bar/cookiebar-latest.min.js?forceLang=en&amp;theme=grey&amp;tracking=1&amp;thirdparty=1&amp;always=1&amp;showPolicyLink=1&amp;remember=English&amp;privacyPage=https%3A%2F%2Fwachulec.me%2Fprivacy%2F"></script></body></html>